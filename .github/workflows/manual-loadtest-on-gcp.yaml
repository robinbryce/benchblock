name: "Run an ad-hoc load test"
on:
  workflow_dispatch:
    inputs:
      project_id:
        description: 'GCP project id (usualy project_name-NUMBER generated by gcp for you)'
        type: string
        default: "fetlar-1"
      location:
        description: 'Kubernetes Engine cluster location'
        type: string
        default: europe-west2-a
      cluster_name:
        description: 'Kubernetes Engine cluster name'
        type: string
        default: "kluster"
      consensus:
        description: 'The name of a consensus scheme supported by blockbench. Eg, raft ibft or rrr'
        type: string
        default: 'raft'
      numnodes:
        description: 'number of nodes required in the network'
        type: string
        default: "3"

      profile:
        description: 'name of a blockbench profile ({consensus}-k8s-{profile}.json in blockbench/configs). defaults to numnodes'
        type: string
        default: ""
jobs:
  run-loadtest-on-gcp:
    uses: robinbryce/blockbench/.github/workflows/loadtest-on-gcp.yaml@main
    with:
      project_id: ${{ github.event.inputs.project_id }}
      location: ${{ github.event.inputs.location }}
      cluster_name: ${{ github.event.inputs.cluster_name }}
      consensus: ${{ github.event.inputs.consensus }}
      profile: ${{ github.event.inputs.profile }}
      numnodes: ${{ github.event.inputs.numnodes }}

    secrets:
      gcp_project_key: ${{ secrets.GCP_PROJECT_KEY_FETLAR }}
